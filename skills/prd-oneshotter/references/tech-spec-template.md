# Tech Spec: [Feature Name]

> Generated by prd-oneshotter skill
> Date: [date]
> PRD Source: [source]
> Design Source: [source]
> Gap Analysis Q&A Source: docs/plans/research/gap-analysis-qa.md

---

## 1. Overview

### Feature Summary
[1-2 sentence description of what we're building]

### Goals
[From Phase 1 PRD Digestion]

### Success Metrics
[From Phase 1 PRD Digestion]

### Constraints
[From Phase 1 PRD Digestion]

---

## 2. Component Hierarchy

### Component Tree

```
FeatureRoot
├── ScreenA
│   ├── HeaderSection
│   │   ├── DesignLibComponent (props: ...)
│   │   └── DesignLibComponent (props: ...)
│   ├── ContentSection
│   │   ├── DesignLibComponent (props: ...)
│   │   └── CustomComponent* (flagged — no library match)
│   └── FooterSection
│       └── DesignLibComponent (props: ...)
├── ScreenB
│   └── ...
└── SharedComponents
    └── ...
```

*Custom components are flagged and approved by the user in Phase 3.

### Component Mapping Table

| UI Element | Design Library Component | Import Path | Props | States |
|-----------|------------------------|-------------|-------|--------|
| [Element from Phase 3] | [Component name] | [Import path from research] | [Key props] | default, loading, error, empty |
| ... | ... | ... | ... | ... |

---

## 3. User Flow Map

### Screen: [Screen Name]

#### Entry Points
| Source | Trigger | Route/Navigation |
|--------|---------|-----------------|
| [Previous screen] | [Tap on X] | [push/modal/tab] |
| Deep link | [URL pattern] | [direct navigation] |

#### Interactions
| Element | Action | Result | Destination | Notes |
|---------|--------|--------|-------------|-------|
| [From Phase 4] | Tap | Navigate | [Screen] | |
| [From Phase 4] | Swipe | [Action] | [Result] | |

#### Exit Points
| Trigger | Destination | Method |
|---------|------------|--------|
| Back button | [Previous screen] | Pop navigation |
| Close button | [Screen] | Dismiss modal |

#### State Transitions
```
Initial → Loading → Loaded
                  → Error → Retry → Loading
Loaded → Refreshing → Loaded
```

[Repeat for each screen]

---

## 4. Data Flow

### Data Sources

| Data | Source | Endpoint/Query | Cache Strategy |
|------|--------|---------------|----------------|
| [Data type] | [API/Local/Derived] | [GET /api/...] | [TTL/invalidation] |
| ... | ... | ... | ... |

### Data Flow Diagram

```
API → Hook/Query → Transform → Component Props → Render
                                    ↓
                              Local State (UI-only state)
```

### Derived State
| Derived Value | Source Data | Computation |
|--------------|------------|-------------|
| [e.g., totalBalance] | [accounts list] | Sum of all account balances |

---

## 5. API Contracts

### Existing Endpoints (from codebase research)

| Endpoint | Method | Purpose | Auth Required |
|----------|--------|---------|--------------|
| [From data-layer.md] | GET/POST | [Purpose] | Yes/No |

### New Endpoints Needed

| Endpoint | Method | Purpose | Request Shape | Response Shape |
|----------|--------|---------|---------------|----------------|
| [If any] | | | ```json { } ``` | ```json { } ``` |

### Error Responses

| Status Code | Meaning | UI Response |
|------------|---------|-------------|
| 400 | Bad request | Show validation errors |
| 401 | Unauthorized | Redirect to login |
| 404 | Not found | Show empty state |
| 500 | Server error | Show error state with retry |

---

## 6. State Management

### Local State (component-level)

| State | Type | Initial Value | Managed By |
|-------|------|---------------|-----------|
| isExpanded | boolean | false | useState |
| selectedTab | string | 'overview' | useState |

### Global State (app-level)

| State | Location | Purpose | Updated By |
|-------|----------|---------|-----------|
| [From data-layer.md patterns] | [Store/Context path] | [Purpose] | [Actions/mutations] |

### Server State (cached API data)

| Query Key | Endpoint | Stale Time | Refetch Triggers |
|-----------|----------|-----------|-----------------|
| [e.g., ['account', id]] | GET /api/accounts/:id | 5 min | Pull-to-refresh, mutation |

---

## 7. Navigation

### Route Definitions

| Route | Screen | Params | Auth Required |
|-------|--------|--------|--------------|
| /feature/overview | OverviewScreen | none | Yes |
| /feature/:id/detail | DetailScreen | id: string | Yes |

### Deep Links

| URL Pattern | Maps To | Params |
|------------|---------|--------|
| app://feature/[id] | DetailScreen | id |

### Transitions

| From → To | Animation | Gesture |
|-----------|-----------|---------|
| Overview → Detail | Push right | Swipe back |
| Any → Modal | Slide up | Swipe down to dismiss |

---

## 8. Error Handling

### Error Boundaries

| Boundary | Scope | Fallback UI |
|----------|-------|-------------|
| Feature-level | Entire feature | "Something went wrong" + retry |
| Screen-level | Individual screen | Error state within layout |
| Component-level | Data-dependent component | Inline error message |

### Retry Logic

| Scenario | Strategy | Max Retries | Backoff |
|----------|----------|-------------|---------|
| Network error | Auto-retry | 3 | Exponential |
| Server error (5xx) | Auto-retry | 2 | Linear |
| Client error (4xx) | No retry | 0 | N/A |

### Offline Behavior

| Feature | Offline Behavior |
|---------|-----------------|
| [Screen/feature] | Show cached data / Show offline banner / Disable |

---

## 9. Accessibility

### Screen Reader Labels

| Element | Label | Hint |
|---------|-------|------|
| [Interactive element] | [Spoken label] | [Action hint] |

### Focus Order
1. [First focusable element]
2. [Second focusable element]
3. ...

### Minimum Tap Targets
- All interactive elements: 44x44pt minimum

---

## 10. Analytics

### Events to Track

| Event Name | Trigger | Properties |
|-----------|---------|-----------|
| feature_viewed | Screen mount | screen_name, entry_source |
| feature_action | User interaction | action_type, element_id |
| feature_error | Error occurred | error_type, error_code |

---

## 11. Testing Strategy

### Unit Tests

| Component/Hook | Test Cases |
|---------------|-----------|
| [Component] | Renders correctly, handles empty state, handles error state |
| [Hook] | Returns correct data, handles loading, handles error |

### Integration Tests

| Flow | Steps | Expected Result |
|------|-------|----------------|
| [User flow] | [Step-by-step] | [Expected outcome] |

### Snapshot Tests
- All screens in default state
- All screens in empty state
- All screens in error state

---

## 12. Implementation Tasks

> These tasks are ordered. Dependencies are noted. Each task is a discrete unit of work
> for one implementation agent.

### Task 1: [Task Name]
- **Description:** [What to build]
- **Files to create/modify:** [List]
- **Dependencies:** None (or Task N)
- **Design library components used:** [List with import paths]
- **Tests:** [What to test]
- **Acceptance criteria:** [How to verify]

### Task 2: [Task Name]
- **Description:** [What to build]
- **Files to create/modify:** [List]
- **Dependencies:** Task 1
- **Design library components used:** [List with import paths]
- **Tests:** [What to test]
- **Acceptance criteria:** [How to verify]

[Continue for all tasks...]

---

## Appendix: Research References

- Design Library: `docs/plans/research/design-library.md`
- Feature Patterns: `docs/plans/research/feature-patterns.md`
- Data Layer: `docs/plans/research/data-layer.md`
- Codebase Context: `docs/plans/research/codebase-context.md`
